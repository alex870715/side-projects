<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIé€£ç·šæ¸¬è©¦å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #5a67d8;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .success { border-left-color: #27ae60; }
        .error { border-left-color: #e74c3c; }
        .warning { border-left-color: #f39c12; }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.loading { background: #cce7ff; color: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” å°è‚¡APIé€£ç·šæ¸¬è©¦å·¥å…·</h1>
            <p>è¨ºæ–·APIé€£ç·šç‹€æ³ï¼Œæ‰¾å‡ºç‚ºä»€éº¼é¡¯ç¤ºæ¨¡æ“¬è³‡æ–™</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š APIç‹€æ…‹æª¢æŸ¥</h3>
            <button class="test-button" onclick="testAllAPIs()">ğŸ”„ æ¸¬è©¦æ‰€æœ‰API</button>
            <button class="test-button" onclick="testTwelveData()">ğŸ“ˆ TwelveData API</button>
            <button class="test-button" onclick="testFinanceAPI()">ğŸ’° Finance API</button>
            <button class="test-button" onclick="testYahooProxy()">ğŸŒ Yahooä»£ç†</button>
            <button class="test-button" onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
            <div id="api-results"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ ç³»çµ±è¨ºæ–·</h3>
            <button class="test-button" onclick="checkSystemStatus()">ğŸ–¥ï¸ ç³»çµ±ç‹€æ…‹</button>
            <button class="test-button" onclick="checkNetworkStatus()">ğŸŒ ç¶²è·¯ç‹€æ…‹</button>
            <button class="test-button" onclick="testCORSSupport()">ğŸ”’ CORSæ”¯æ´</button>
            <div id="system-results"></div>
        </div>

        <div class="test-section">
            <h3>âš¡ å¿«é€Ÿä¿®å¾©</h3>
            <button class="test-button" onclick="showAPIKeyInstructions()">ğŸ”‘ API Keyè¨­å®š</button>
            <button class="test-button" onclick="switchToProxy()">ğŸ”„ åˆ‡æ›ä»£ç†æ¨¡å¼</button>
            <button class="test-button" onclick="enableSmartSimulation()">ğŸ¤– æ™ºèƒ½æ¨¡æ“¬æ¨¡å¼</button>
            <div id="fix-results"></div>
        </div>
    </div>

    <script src="real-api-client.js"></script>
    <script>
        let apiClient = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof DirectStockAPIClient !== 'undefined') {
                    apiClient = new DirectStockAPIClient();
                    addResult('system-results', 'âœ… DirectStockAPIClient è¼‰å…¥æˆåŠŸ', 'success');
                } else {
                    addResult('system-results', 'âŒ DirectStockAPIClient è¼‰å…¥å¤±æ•—', 'error');
                }
            } catch (error) {
                addResult('system-results', `âŒ åˆå§‹åŒ–éŒ¯èª¤: ${error.message}`, 'error');
            }
        });

        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `result ${type}`;
            result.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            container.appendChild(result);
            container.scrollTop = container.scrollHeight;
        }

        async function testAllAPIs() {
            addResult('api-results', 'ğŸ”„ é–‹å§‹æ¸¬è©¦æ‰€æœ‰API...', 'loading');
            
            await testTwelveData();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testFinanceAPI();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testYahooProxy();
            
            addResult('api-results', 'âœ… æ‰€æœ‰APIæ¸¬è©¦å®Œæˆ', 'success');
        }

        async function testTwelveData() {
            addResult('api-results', 'ğŸ“ˆ æ¸¬è©¦ TwelveData API...', 'loading');
            
            try {
                const url = 'https://api.twelvedata.com/time_series?symbol=2330.TPE&interval=1day&outputsize=5&apikey=demo';
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.values && data.values.length > 0) {
                    addResult('api-results', `âœ… TwelveData: æˆåŠŸç²å–è³‡æ–™ (${data.values.length}ç­†)`, 'success');
                } else if (data.message && data.message.includes('limit')) {
                    addResult('api-results', 'âš ï¸ TwelveData: APIå‘¼å«é™åˆ¶å·²é”ä¸Šé™', 'warning');
                } else {
                    addResult('api-results', `âŒ TwelveData: ${data.message || 'ç„¡æœ‰æ•ˆè³‡æ–™'}`, 'error');
                }
            } catch (error) {
                addResult('api-results', `âŒ TwelveData: é€£ç·šå¤±æ•— - ${error.message}`, 'error');
            }
        }

        async function testFinanceAPI() {
            addResult('api-results', 'ğŸ’° æ¸¬è©¦ Financial Modeling Prep API...', 'loading');
            
            try {
                const url = 'https://financialmodelingprep.com/api/v3/quote/2330.TPE?apikey=demo';
                const response = await fetch(url);
                const data = await response.json();
                
                if (data && data.length > 0 && data[0].price) {
                    addResult('api-results', `âœ… Finance API: æˆåŠŸç²å–è³‡æ–™ (åƒ¹æ ¼: $${data[0].price})`, 'success');
                } else if (data.error && data.error.includes('limit')) {
                    addResult('api-results', 'âš ï¸ Finance API: APIå‘¼å«é™åˆ¶å·²é”ä¸Šé™', 'warning');
                } else {
                    addResult('api-results', `âŒ Finance API: ${data.error || 'ç„¡æœ‰æ•ˆè³‡æ–™'}`, 'error');
                }
            } catch (error) {
                addResult('api-results', `âŒ Finance API: é€£ç·šå¤±æ•— - ${error.message}`, 'error');
            }
        }

        async function testYahooProxy() {
            addResult('api-results', 'ğŸŒ æ¸¬è©¦ Yahoo Finance ä»£ç†...', 'loading');
            
            const proxyUrls = [
                'https://api.allorigins.win/raw?url=',
                'https://corsproxy.io/?'
            ];

            for (const proxy of proxyUrls) {
                try {
                    const targetUrl = 'https://query1.finance.yahoo.com/v8/finance/chart/2330.TW';
                    const response = await fetch(proxy + encodeURIComponent(targetUrl));
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.chart && data.chart.result) {
                            addResult('api-results', `âœ… Yahoo (${proxy}): æˆåŠŸç²å–è³‡æ–™`, 'success');
                            return;
                        }
                    }
                } catch (error) {
                    addResult('api-results', `âŒ Yahoo (${proxy}): ${error.message}`, 'error');
                }
            }
            
            addResult('api-results', 'âŒ Yahoo Finance: æ‰€æœ‰ä»£ç†éƒ½å¤±æ•—', 'error');
        }

        function checkSystemStatus() {
            addResult('system-results', 'ğŸ–¥ï¸ æª¢æŸ¥ç³»çµ±ç‹€æ…‹...', 'loading');
            
            // æª¢æŸ¥å„ç¨®ç³»çµ±çµ„ä»¶
            const checks = [
                { name: 'DirectStockAPIClient', condition: typeof DirectStockAPIClient !== 'undefined' },
                { name: 'Fetch API', condition: typeof fetch !== 'undefined' },
                { name: 'Promise', condition: typeof Promise !== 'undefined' },
                { name: 'JSON', condition: typeof JSON !== 'undefined' },
                { name: 'Local Storage', condition: typeof localStorage !== 'undefined' }
            ];
            
            checks.forEach(check => {
                const status = check.condition ? 'âœ…' : 'âŒ';
                const type = check.condition ? 'success' : 'error';
                addResult('system-results', `${status} ${check.name}: ${check.condition ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}`, type);
            });
        }

        async function checkNetworkStatus() {
            addResult('system-results', 'ğŸŒ æª¢æŸ¥ç¶²è·¯ç‹€æ…‹...', 'loading');
            
            try {
                const response = await fetch('https://httpbin.org/get');
                if (response.ok) {
                    addResult('system-results', 'âœ… ç¶²è·¯é€£ç·šæ­£å¸¸', 'success');
                } else {
                    addResult('system-results', 'âš ï¸ ç¶²è·¯é€£ç·šç•°å¸¸', 'warning');
                }
            } catch (error) {
                addResult('system-results', `âŒ ç¶²è·¯é€£ç·šå¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function testCORSSupport() {
            addResult('system-results', 'ğŸ”’ æ¸¬è©¦CORSæ”¯æ´...', 'loading');
            
            try {
                const response = await fetch('https://api.github.com/users/github');
                if (response.ok) {
                    addResult('system-results', 'âœ… CORSè«‹æ±‚æ”¯æ´æ­£å¸¸', 'success');
                } else {
                    addResult('system-results', 'âš ï¸ CORSè«‹æ±‚éƒ¨åˆ†é™åˆ¶', 'warning');
                }
            } catch (error) {
                addResult('system-results', `âŒ CORSè«‹æ±‚è¢«é˜»æ“‹: ${error.message}`, 'error');
            }
        }

        function showAPIKeyInstructions() {
            const instructions = `
ğŸ”‘ API Key è¨­å®šæŒ‡å—ï¼š

1. ç”³è«‹ TwelveData API Keyï¼š
   - å‰å¾€ https://twelvedata.com/
   - è¨»å†Šå…è²»å¸³è™Ÿ
   - ç²å– API Key

2. æ›´æ–°ç¨‹å¼ç¢¼ï¼š
   - ç·¨è¼¯ real-api-client.js
   - æ‰¾åˆ°ç¬¬56è¡Œå·¦å³
   - å°‡ 'demo' æ›¿æ›ç‚ºæ‚¨çš„ API Key

3. é‡æ–°è¼‰å…¥é é¢æ¸¬è©¦

å»ºè­°ç”³è«‹å¤šå€‹API Keyè¼ªæ›¿ä½¿ç”¨ï¼š
- TwelveData: æ¯æ—¥800æ¬¡
- Financial Modeling Prep: æ¯æ—¥250æ¬¡
- Alpha Vantage: æ¯æ—¥500æ¬¡
            `;
            addResult('fix-results', instructions, 'info');
        }

        function switchToProxy() {
            const instructions = `
ğŸ”„ åˆ‡æ›åˆ°ä»£ç†æ¨¡å¼ï¼š

1. å•Ÿå‹•æœ¬åœ°ä»£ç†ä¼ºæœå™¨ï¼š
   npm start

2. é–‹å•Ÿä»£ç†æ¨¡å¼ç¶²å€ï¼š
   http://localhost:3001/index.html

3. ä»£ç†ä¼ºæœå™¨çš„å„ªé»ï¼š
   - ç¹éCORSé™åˆ¶
   - æ›´ç©©å®šçš„APIå‘¼å«
   - çµ±ä¸€çš„éŒ¯èª¤è™•ç†

æ³¨æ„ï¼šéœ€è¦Node.jsç’°å¢ƒ
            `;
            addResult('fix-results', instructions, 'info');
        }

        function enableSmartSimulation() {
            const info = `
ğŸ¤– æ™ºèƒ½æ¨¡æ“¬æ¨¡å¼èªªæ˜ï¼š

ç•¶å‰ä½¿ç”¨çš„æ™ºèƒ½æ¨¡æ“¬è³‡æ–™ç‰¹è‰²ï¼š
- åŸºæ–¼çœŸå¯¦è‚¡ç¥¨åŸºæº–åƒ¹æ ¼
- è€ƒæ…®å¸‚å ´é–‹ç›¤æ™‚é–“å½±éŸ¿
- æ¨¡æ“¬çœŸå¯¦çš„åƒ¹æ ¼æ³¢å‹•
- ç”Ÿæˆåˆç†çš„æˆäº¤é‡
- æ‰€æœ‰æŠ€è¡“æŒ‡æ¨™è¨ˆç®—å®Œå…¨æº–ç¢º

é›–ç„¶ä¸æ˜¯å³æ™‚çœŸå¯¦è³‡æ–™ï¼Œä½†ï¼š
- å­¸ç¿’æŠ€è¡“åˆ†æå®Œå…¨å¯è¡Œ
- æ¸¬è©¦æŠ•è³‡ç­–ç•¥æœ‰æ•ˆ
- äº†è§£åœ–è¡¨æ“ä½œç„¡å•é¡Œ
- AIåˆ†æé‚è¼¯å®Œå…¨ç›¸åŒ

å»ºè­°ï¼šç”³è«‹å…è²»API Keyç²å¾—çœŸå¯¦è³‡æ–™
            `;
            addResult('fix-results', info, 'info');
        }

        function clearResults() {
            document.getElementById('api-results').innerHTML = '';
            document.getElementById('system-results').innerHTML = '';
            document.getElementById('fix-results').innerHTML = '';
        }
    </script>
</body>
</html>
